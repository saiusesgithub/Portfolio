---
import { siteData } from '../data/portfolio';

const roles = [
  'CLOUD ENGINEER',
  'DEVOPS PRACTITIONER',
  'OPEN SOURCE CONTRIBUTOR',
  'CI/CD ARCHITECT',
  'INFRASTRUCTURE BUILDER',
];

const photoUrl = '/photo.png';

// Generate some dummy static ASCII for the placeholder background
const staticAsciiRows = Array(15).fill(0).map(() => {
  return Array(20).fill(0).map(() => Math.random() > 0.5 ? '1' : '0').join(' ');
});
---

<section id="about" class="w-full border-beam-b grid grid-cols-1 lg:grid-cols-12 h-[calc(100vh-5rem)] min-h-[600px] relative bg-concrete overflow-hidden">
  <!-- The 100 Orange Squares Overlay -->
  <div id="grid-overlay" class="fixed inset-0 z-[300] w-full h-full" style="pointer-events: none;"></div>

  <!-- Left: Typography & Info -->
  <div class="lg:col-span-8 border-beam-b lg:border-b-0 flex flex-col p-4 lg:p-8 relative overflow-hidden bg-concrete z-10">
    
    <!-- Top Bar & Warning Tape -->
    <div class="flex justify-between items-center font-tech text-[10px] uppercase tracking-widest text-gray-500 mb-2 mt-2 lg:mt-0 relative z-20">
      <div class="flex items-center gap-2 border-2 border-black px-2 py-1 bg-white shadow-[2px_2px_0_0_#000]">
        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse border border-black"></span>
        <span class="text-black font-bold uppercase">SYSTEM ONLINE</span>
      </div>
      
      <!-- Warning Tape snippet -->
      <div class="hidden sm:block absolute left-1/2 -top-4 w-32 h-3 bg-[repeating-linear-gradient(-45deg,#000,#000_4px,#ff4500_4px,#ff4500_8px)] border-y border-black -translate-x-1/2"></div>
      
      <div class="border-2 border-black px-2 py-1 bg-white text-black font-bold shadow-[2px_2px_0_0_#000]">{siteData.coordinates}</div>
    </div>

    <!-- Sticker Slap (Absolute) -->
    <div class="absolute top-[20%] right-[10%] rotate-[15deg] z-20 border-2 border-black bg-[#ff4500] text-black px-3 py-1 shadow-[4px_4px_0_0_#000] font-black text-[10px] lg:text-xs uppercase hidden md:block">
      <span class="mr-1">⚠</span> ROOT_ACCESS
    </div>

    <!-- Middle: Full-width Giant Name -->
    <div class="flex-1 flex flex-col justify-center gap-2 py-2 relative z-10 min-h-0">
      <h1 class="w-full font-black uppercase leading-[0.80] tracking-tight select-none text-black drop-shadow-sm mb-2" style="font-size: clamp(3rem, 10vw, 11rem);">
        {siteData.name.split(' ')[0]}<br/>
        <span class="text-safety-orange" style="text-shadow: -4px 4px 0 #000, -3px 3px 0 #000;">{siteData.name.split(' ').slice(1).join(' ')}</span>
      </h1>
    </div>

    <!-- Bottom text row -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-end gap-4 pt-4 mt-auto border-t-2 border-black w-full shrink-0 relative z-20">
      
      <!-- Role Pills & Tagline -->
      <div class="flex-1 w-full sm:w-auto">
        <div class="flex flex-wrap gap-2 mb-2 max-w-md">
          {roles.slice(0, 3).map(role => (
            <span class="border-2 border-black bg-white text-black text-[9px] lg:text-[10px] font-bold uppercase tracking-widest px-2 py-1 shadow-[2px_2px_0_0_#000]">
              {role}
            </span>
          ))}
        </div>
        
        <p class="text-sm sm:text-lg lg:text-xl font-black text-black h-6 sm:h-8 flex items-center uppercase tracking-tight">
          <span id="typed-text"></span><span class="typing-cursor text-safety-orange bg-safety-orange inline-block w-3 h-5 ml-1"></span>
        </p>
      </div>

      <div class="flex items-end gap-4 shrink-0">
        <!-- Barcode Decor -->
        <div class="hidden xl:flex flex-col items-end justify-end pb-1 opacity-80 select-none">
          <div class="w-16 h-8 flex gap-[2px]">
            <div class="w-[3px] h-full bg-black"></div>
            <div class="w-[1px] h-full bg-black"></div>
            <div class="w-[4px] h-full bg-black"></div>
            <div class="w-[2px] h-full bg-black"></div>
            <div class="w-[1px] h-full bg-black"></div>
            <div class="w-[3px] h-full bg-black"></div>
            <div class="w-[2px] h-full bg-black"></div>
            <div class="w-[4px] h-full bg-black"></div>
            <div class="w-[1px] h-full bg-black"></div>
            <div class="w-[3px] h-full bg-black"></div>
            <div class="w-[1px] h-full bg-black"></div>
            <div class="w-[2px] h-full bg-black"></div>
          </div>
          <span class="font-tech text-[8px] uppercase tracking-widest mt-1 font-bold text-black">A-0429</span>
        </div>

        <!-- CTA Button -->
        <a 
          href="#projects" 
          class="cursor-target border-2 border-black bg-safety-orange text-black px-6 py-3 lg:px-8 lg:py-4 font-bold uppercase text-xs lg:text-sm tracking-wider hover:bg-black hover:text-white transition-colors duration-0 flex items-center gap-3 group shrink-0 shadow-[4px_4px_0_0_rgba(0,0,0,1)] hover:shadow-none hover:translate-x-1 hover:translate-y-1 relative"
        >
          <!-- Tiny tape on the button corner -->
          <div class="absolute -top-1 -right-1 w-4 h-4 bg-[repeating-linear-gradient(-45deg,#000,#000_2px,#fff_2px,#fff_4px)]"></div>
          View Projects
          <i data-lucide="arrow-down-right" class="w-4 h-4 lg:w-5 lg:h-5 transition-transform duration-200"></i>
        </a>
      </div>
    </div>
  </div>

  <!-- Right: Brutalist Photo Square -->
  <div class="lg:col-span-4 bg-concrete flex flex-col items-center justify-center p-4 lg:p-8 relative border-t-2 lg:border-t-0 lg:border-l-2 border-black z-10">
    
    <!-- Top right decor in the right panel -->
    <div class="absolute top-4 right-4 flex gap-1 z-20">
      <div class="w-3 h-3 border-2 border-black bg-white"></div>
      <div class="w-3 h-3 border-2 border-black bg-safety-orange"></div>
      <div class="w-3 h-3 border-2 border-black bg-black"></div>
    </div>

    <!-- Long Warning Tape extending across the right edge -->
    <div class="absolute right-0 top-1/4 bottom-1/4 w-1 hidden lg:block bg-[repeating-linear-gradient(45deg,#000,#000_4px,#ff4500_4px,#ff4500_8px)] opacity-60"></div>

    <div class="w-full max-w-[280px] lg:max-w-[320px] xl:max-w-[360px] aspect-square relative border-4 border-black bg-black shadow-[10px_10px_0_0_#ff4500] group overflow-hidden cursor-crosshair transition-transform duration-300 hover:-translate-y-1 hover:-translate-x-1 hover:shadow-[14px_14px_0_0_#ff4500]">
      
      <!-- DEFAULT STATE: Static ASCII / Tech Pattern -->
      <div class="absolute inset-0 bg-black flex flex-col items-center justify-center p-4 text-safety-orange font-mono text-[7px] lg:text-[8px] leading-[7px] lg:leading-[8px] opacity-100 group-hover:opacity-0 transition-opacity duration-300 z-10" style="word-break: break-all;">
        <div class="opacity-40 select-none text-center">
          {staticAsciiRows.map(row => <div class="whitespace-nowrap">{row}</div>)}
        </div>
        
        <!-- Crosshair & Target Overlay -->
        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
          <div class="w-full h-px bg-safety-orange opacity-20"></div>
          <div class="h-full w-px bg-safety-orange opacity-20 absolute top-0 left-1/2"></div>
          <div class="w-20 h-20 border border-safety-orange rounded-full flex items-center justify-center">
            <div class="w-12 h-12 border border-safety-orange rounded-full border-dashed animate-[spin_10s_linear_infinite]"></div>
          </div>
          <div class="absolute bg-black px-2 py-1 border border-safety-orange font-tech text-[8px] lg:text-[10px]">
            HOVER_TO_DECRYPT
          </div>
        </div>
      </div>

      <!-- HOVER STATE: Actual Photo with Brutalist Tweaks -->
      <div class="absolute inset-0 bg-black opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20">
        <img 
          src={photoUrl} 
          alt="Sai Srujan" 
          class="w-full h-full object-cover grayscale-[0.8] contrast-125 hover:grayscale-[0.2] transition-all duration-500 mix-blend-luminosity hover:mix-blend-normal" 
        />
        
        <!-- Scanline Overlay -->
        <div class="absolute inset-0 pointer-events-none opacity-20" style="background-image: repeating-linear-gradient(transparent, transparent 2px, black 2px, black 4px);"></div>
        
        <!-- Corner Brackets -->
        <div class="absolute top-2 left-2 w-6 h-6 border-t-4 border-l-4 border-safety-orange"></div>
        <div class="absolute top-2 right-2 w-6 h-6 border-t-4 border-r-4 border-safety-orange"></div>
        <div class="absolute bottom-2 left-2 w-6 h-6 border-b-4 border-l-4 border-safety-orange"></div>
        <div class="absolute bottom-2 right-2 w-6 h-6 border-b-4 border-r-4 border-safety-orange"></div>
      </div>
    </div>
    
    <!-- Sticker Slaps on the Photo Frame (Outside the inner hover layer so they always show) -->
    <!-- Verified Badge -->
    <div class="absolute bottom-10 left-8 lg:bottom-16 lg:left-12 border-2 border-black bg-white text-black px-3 py-1 font-black text-[10px] transform -rotate-6 shadow-[2px_2px_0_0_#000] z-30 pointer-events-none group-hover:-rotate-3 transition-transform">
      <span class="text-green-500 mr-1">✔</span> VERIFIED
    </div>
    <!-- Tiny abstract sticker -->
    <div class="absolute top-12 left-6 lg:top-20 lg:left-10 border-2 border-black bg-safety-orange w-8 h-4 transform rotate-12 shadow-[2px_2px_0_0_#000] z-30 pointer-events-none"></div>

    <!-- Decor labels -->
    <div class="absolute bottom-4 right-4 font-tech text-[10px] uppercase text-black flex flex-col text-right select-none z-20">
      <span class="font-bold border-b-2 border-black pb-1 mb-1">RUNTIME: ACTIVE</span>
      <span class="text-gray-500">IMG_SYS_ONLINE</span>
    </div>
  </div>
</section>

<style is:global>
  /* typing cursor */
  .typing-cursor {
    animation: blink-cursor 0.8s step-end infinite;
  }

  @keyframes blink-cursor {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
</style>

<script is:inline>
  // ========================================
  // GRID OVERLAY (100 squares)
  // ========================================
  (function() {
    function initGridOverlay() {
      var gridContainer = document.getElementById('grid-overlay');
      if (!gridContainer) return;
      gridContainer.innerHTML = '';
      var totalSquares = 100;
      var fadedCount = 0;

      for (var i = 0; i < totalSquares; i++) {
        var square = document.createElement('div');
        square.className = 'grid-square';
        square.style.pointerEvents = 'auto';
        
        square.addEventListener('mouseover', function() {
          if (!this.classList.contains('fade-out')) {
            this.classList.add('fade-out');
            fadedCount++;
            if (fadedCount >= totalSquares) {
              gridContainer.remove();
            }
          }
        });

        square.addEventListener('touchstart', function() {
          if (!this.classList.contains('fade-out')) {
            this.classList.add('fade-out');
            fadedCount++;
            if (fadedCount >= totalSquares) {
              gridContainer.remove();
            }
          }
        }, { passive: true });

        gridContainer.appendChild(square);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initGridOverlay);
    } else {
      initGridOverlay();
    }
  })();

  // ========================================
  // TYPING EFFECT
  // ========================================
  (function() {
    var tagline = 'Building Digital Infrastructure.';
    var typedEl = document.getElementById('typed-text');
    var charIndex = 0;

    function typeChar() {
      if (!typedEl) return;
      if (charIndex < tagline.length) {
        typedEl.textContent += tagline[charIndex];
        charIndex++;
        setTimeout(typeChar, 40 + Math.random() * 40);
      }
    }

    // Start typing after ~2s to allow preloader to clear
    setTimeout(typeChar, 2000);
  })();
</script>
