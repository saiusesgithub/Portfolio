---
import { siteData } from '../data/portfolio';

const navLinks = [
  { id: '01', name: 'About', href: '#about' },
  { id: '02', name: 'Skills', href: '#skills' },
  { id: '03', name: 'Experience', href: '#experience' },
];

const nameParts = siteData.name.split(' ');
---

<header id="main-header" class="fixed top-0 left-0 w-full z-[200]">

  <!-- ═══════════════════════════════════════ -->
  <!-- TOP MICRO-BAR: System Status Strip      -->
  <!-- ═══════════════════════════════════════ -->
  <div id="micro-bar" class="w-full bg-black text-white border-b-2 border-black flex items-center justify-between px-4 overflow-hidden" style="height: 1.6rem;">
    <!-- Left: Uptime + blink dot -->
    <div class="flex items-center gap-3 font-tech text-[10px] uppercase tracking-widest">
      <span class="flex items-center gap-1.5">
        <span class="inline-block w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"></span>
        <span>SYS_ACTIVE</span>
      </span>
      <span class="text-gray-500">|</span>
      <span>UPTIME: <span id="uptime-display" class="text-safety-orange">00:00:00</span></span>
      <span class="text-gray-500">|</span>
      <span class="hidden sm:inline">LOC: <span class="text-safety-orange">HYD, IND</span></span>
    </div>

    <!-- Center: Current section scrolling label -->
    <div class="absolute left-1/2 -translate-x-1/2 font-tech text-[10px] uppercase tracking-[0.3em] text-gray-400 hidden md:block">
      <span id="current-section-label">/// SECTION: HERO</span>
    </div>

    <!-- Right: Live clock -->
    <div class="font-tech text-[10px] uppercase tracking-widest text-gray-400">
      <span id="live-clock">--:--:--</span>
      <span class="ml-2 text-gray-600">IST</span>
    </div>
  </div>

  <!-- ═══════════════════════════════════════ -->
  <!-- MAIN NAV BAR                            -->
  <!-- ═══════════════════════════════════════ -->
  <nav id="main-nav" class="w-full bg-white border-b-4 border-black flex items-stretch" style="box-shadow: 0 6px 0 0 #ff4500;">

    <!-- Logo / Name Plate -->
    <div class="relative flex items-center shrink-0 border-r-4 border-black">
      <!-- Caution tape vertical accent on the far left edge -->
      <div class="absolute left-0 top-0 bottom-0 w-[6px] bg-[repeating-linear-gradient(-45deg,#000,#000_3px,#ff4500_3px,#ff4500_6px)]"></div>

      <a href="#" class="flex items-center h-full px-8 pl-10">
        <span class="font-black text-2xl lg:text-3xl uppercase tracking-tight whitespace-nowrap select-none text-black">
          {nameParts[0]}<span class="text-safety-orange">&nbsp;{nameParts.slice(1).join(' ')}</span>
        </span>
      </a>
    </div>

    <!-- Nav Links — chunky segmented blocks -->
    <div class="hidden lg:flex flex-1 items-stretch justify-end">
      {navLinks.map(link => (
        <a
          href={link.href}
          class="nav-link cursor-target group flex flex-col items-center justify-center px-6 xl:px-10 border-l-4 border-black font-black uppercase text-sm tracking-wider bg-white text-black hover:bg-black hover:text-white transition-colors duration-0 relative"
          data-section={link.href.replace('#', '')}
        >
          <span class="font-tech text-[9px] font-normal text-gray-400 group-hover:text-gray-300 mb-0.5 tracking-widest leading-none">{link.id}</span>
          <span class="leading-none">{link.name}</span>
        </a>
      ))}

      <!-- Contact CTA — Caution tape on the left edge + orange fill -->
      <div class="relative border-l-4 border-black">
        <!-- Caution tape vertical accent between last link and contact -->
        <div class="absolute left-0 top-0 bottom-0 w-[6px] bg-[repeating-linear-gradient(-45deg,#000,#000_3px,#ff4500_3px,#ff4500_6px)] -translate-x-full z-10"></div>
        <a
          href="#contact"
          class="nav-link cursor-target group flex flex-col items-center justify-center px-8 xl:px-12 h-full bg-safety-orange text-black hover:bg-black hover:text-white transition-colors duration-0 font-black uppercase text-sm tracking-wider relative"
          data-section="contact"
        >
          <span class="font-tech text-[9px] font-normal text-black/60 group-hover:text-gray-300 mb-0.5 tracking-widest leading-none">04</span>
          <span class="leading-none">Contact</span>
        </a>
      </div>
    </div>

    <!-- Mobile Hamburger -->
    <button id="mobile-menu-btn" class="lg:hidden ml-auto flex items-center justify-center px-5 border-l-4 border-black bg-white hover:bg-black hover:text-white transition-colors duration-0 active:bg-safety-orange">
      <svg id="hamburger-icon" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
        <path stroke-linecap="square" d="M3 6h18M3 12h18M3 18h18" />
      </svg>
    </button>
  </nav>

  <!-- ═══════════════════════════════════════ -->
  <!-- SCROLL PROGRESS BAR                     -->
  <!-- ═══════════════════════════════════════ -->
  <div class="w-full h-[3px] bg-gray-200 border-b border-black relative">
    <div id="scroll-progress" class="h-full bg-safety-orange transition-none" style="width: 0%;"></div>
  </div>

</header>

<!-- Mobile Full-Screen Menu Overlay -->
<div id="mobile-overlay" class="fixed inset-0 z-[400] bg-black flex-col items-stretch justify-center hidden">
  <!-- Close button -->
  <div class="absolute top-0 left-0 right-0 flex items-center justify-between px-6 border-b-4 border-safety-orange h-16">
    <span class="font-tech text-safety-orange text-xs uppercase tracking-widest">NAVIGATION_MENU</span>
    <button id="mobile-close-btn" class="border-2 border-safety-orange text-safety-orange font-black text-xl px-4 py-1 hover:bg-safety-orange hover:text-black transition-colors duration-0">
      [×]
    </button>
  </div>

  <nav class="flex flex-col mt-16">
    {navLinks.map((link, i) => (
      <a
        href={link.href}
        class="mobile-nav-link flex items-center gap-6 border-b-4 border-[#222] px-8 py-8 text-white hover:bg-safety-orange hover:text-black hover:border-safety-orange transition-colors duration-0 group"
      >
        <span class="font-tech text-2xl text-gray-600 group-hover:text-black">{link.id}</span>
        <span class="font-black text-5xl uppercase tracking-tight">{link.name}</span>
      </a>
    ))}
    <a
      href="#contact"
      class="mobile-nav-link flex items-center gap-6 border-b-4 border-safety-orange px-8 py-8 bg-safety-orange text-black hover:bg-white hover:text-black transition-colors duration-0 group"
    >
      <span class="font-tech text-2xl text-black/50">04</span>
      <span class="font-black text-5xl uppercase tracking-tight">Contact</span>
    </a>
  </nav>

  <!-- Bottom decor strip -->
  <div class="absolute bottom-0 left-0 right-0 h-2 bg-[repeating-linear-gradient(90deg,#ff4500,#ff4500_20px,#000_20px,#000_40px)]"></div>
</div>

<!-- Spacer for Fixed Header -->
<div id="nav-spacer" class="w-full"></div>

<style is:global>
  /* Nav height */
  #main-nav {
    height: 4rem;
    transition: height 0.2s ease;
  }
  #main-header.nav-shrunk #main-nav {
    height: 3rem;
  }

  /* Micro bar height */
  #micro-bar {
    height: 1.6rem;
  }

  /* Total spacer */
  #nav-spacer {
    height: calc(4rem + 1.6rem + 3px); /* main + micro + progress bar */
    transition: height 0.2s ease;
  }
  #main-header.nav-shrunk ~ #nav-spacer {
    height: calc(3rem + 1.6rem + 3px);
  }

  /* Active nav link: physical press-down key effect */
  .nav-link.nav-active {
    background-color: #000 !important;
    color: #fff !important;
    box-shadow: inset 3px 3px 0 0 rgba(255,255,255,0.1), inset -1px -1px 0 0 #555;
  }
  
  /* Make sure orange contact button active state differs */
  a[data-section="contact"].nav-link.nav-active {
    background-color: #000 !important;
    color: #ff4500 !important;
  }

  /* Mobile overlay transitions */
  #mobile-overlay.open {
    display: flex;
  }
</style>

<script is:inline>
(function () {

  // ─── Live Clock ───────────────────────────
  function updateClock() {
    var el = document.getElementById('live-clock');
    if (!el) return;
    var now = new Date();
    var h = String(now.getHours()).padStart(2, '0');
    var m = String(now.getMinutes()).padStart(2, '0');
    var s = String(now.getSeconds()).padStart(2, '0');
    el.textContent = h + ':' + m + ':' + s;
  }
  updateClock();
  setInterval(updateClock, 1000);

  // ─── Uptime Counter (since page load) ─────
  var pageLoadTime = Date.now();
  function updateUptime() {
    var el = document.getElementById('uptime-display');
    if (!el) return;
    var elapsed = Math.floor((Date.now() - pageLoadTime) / 1000);
    var h = Math.floor(elapsed / 3600);
    var m = Math.floor((elapsed % 3600) / 60);
    var s = elapsed % 60;
    el.textContent = String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
  }
  updateUptime();
  setInterval(updateUptime, 1000);

  // ─── Scroll Progress Bar ──────────────────
  function updateProgress() {
    var bar = document.getElementById('scroll-progress');
    if (!bar) return;
    var scrollTop = window.scrollY;
    var docHeight = document.documentElement.scrollHeight - window.innerHeight;
    var pct = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
    bar.style.width = pct.toFixed(1) + '%';
  }
  window.addEventListener('scroll', updateProgress, { passive: true });

  // ─── Current Section Label ────────────────
  // ─── Current Section Label + Active Nav ──
  var sectionNames = {
    'about':      'HERO',
    'skills':     'SKILLS',
    'projects':   'PROJECTS',
    'experience': 'EXPERIENCE',
    'contact':    'CONTACT',
  };

  var sectionLabel = document.getElementById('current-section-label');
  var navLinks = document.querySelectorAll('.nav-link[data-section]');
  var allSections = Array.from(document.querySelectorAll('section[id]'));
  var lastActiveId = '';

  function updateActiveSection() {
    // Find the section whose top is closest to (but above) 40% of the viewport
    var triggerY = window.innerHeight * 0.4;
    var activeSection = null;

    for (var i = 0; i < allSections.length; i++) {
      var rect = allSections[i].getBoundingClientRect();
      if (rect.top <= triggerY) {
        activeSection = allSections[i];
      }
    }

    if (!activeSection) activeSection = allSections[0];
    var id = activeSection ? activeSection.id : '';

    if (id && id !== lastActiveId) {
      lastActiveId = id;

      // Update label
      if (sectionLabel) {
        var label = sectionNames[id] || id.toUpperCase();
        sectionLabel.textContent = '/// SECTION: ' + label;
      }

      // Update active nav links
      navLinks.forEach(function(link) {
        link.classList.toggle('nav-active', link.dataset.section === id);
      });
    }
  }

  window.addEventListener('scroll', updateActiveSection, { passive: true });
  updateActiveSection(); // run once on load

  // ─── Navbar Shrink on Scroll ──────────────
  var header = document.getElementById('main-header');
  var spacer = document.getElementById('nav-spacer');
  var shrunk = false;

  window.addEventListener('scroll', function() {
    var shouldShrink = window.scrollY > 80;
    if (shouldShrink !== shrunk) {
      shrunk = shouldShrink;
      if (header) header.classList.toggle('nav-shrunk', shrunk);
    }
  }, { passive: true });

  // ─── Mobile Menu ──────────────────────────
  var overlay = document.getElementById('mobile-overlay');
  var openBtn = document.getElementById('mobile-menu-btn');
  var closeBtn = document.getElementById('mobile-close-btn');
  var mobileLinks = document.querySelectorAll('.mobile-nav-link');

  if (openBtn && overlay) {
    openBtn.addEventListener('click', function() {
      overlay.classList.add('open');
      document.body.style.overflow = 'hidden';
    });
  }
  function closeMenu() {
    if (overlay) overlay.classList.remove('open');
    document.body.style.overflow = '';
  }
  if (closeBtn) closeBtn.addEventListener('click', closeMenu);
  mobileLinks.forEach(function(link) {
    link.addEventListener('click', closeMenu);
  });

})();
</script>
