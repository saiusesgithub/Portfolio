---
import { siteData } from '../data/portfolio';

const roles = [
  'CLOUD ENGINEER',
  'DEVOPS PRACTITIONER',
  'OPEN SOURCE CONTRIBUTOR',
  'CI/CD ARCHITECT',
  'INFRASTRUCTURE BUILDER',
];

const photoUrl = '/photo.png';

// Generate some dummy static ASCII for the placeholder background
const staticAsciiRows = Array(15).fill(0).map(() => {
  return Array(20).fill(0).map(() => Math.random() > 0.5 ? '1' : '0').join(' ');
});
---

<section id="about" class="w-full border-beam-b grid grid-cols-1 lg:grid-cols-12 min-h-screen relative bg-concrete">
  <!-- The 100 Orange Squares Overlay -->
  <div id="grid-overlay" class="fixed inset-0 z-[300] w-full h-full" style="pointer-events: none;"></div>

  <!-- Left: Typography & Info -->
  <div class="lg:col-span-8 border-beam-b lg:border-b-0 flex flex-col p-6 lg:p-12 relative overflow-hidden bg-concrete">
    <!-- Top Bar -->
    <div class="flex justify-between items-center font-tech text-[10px] uppercase tracking-widest text-gray-500 mb-8 mt-16 md:mt-20 lg:mt-0">
      <div class="flex items-center gap-2 border-2 border-black px-2 py-1 bg-white">
        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse border border-black"></span>
        <span class="text-black font-bold uppercase">{siteData.status}</span>
      </div>
      <div class="border-2 border-black px-2 py-1 bg-white text-black font-bold">{siteData.coordinates}</div>
    </div>

    <!-- Middle: Full-width Giant Name -->
    <div class="flex-1 flex flex-col justify-center gap-4 py-8 relative z-10">
      <!-- Decorative background '+' icons -->
      <div class="absolute inset-0 pointer-events-none opacity-20" style="background-image: radial-gradient(#000 1px, transparent 1px); background-size: 30px 30px;"></div>
      
      <h1 class="w-full font-black uppercase leading-[0.85] tracking-tight select-none text-black drop-shadow-sm mb-4" style="font-size: clamp(4rem, 11vw, 13rem);">
        {siteData.name.split(' ')[0]}<br/>
        <span class="text-safety-orange" style="text-shadow: -4px 4px 0 #000, -4px 4px 0 #000;">{siteData.name.split(' ').slice(1).join(' ')}</span>
      </h1>
      
      <p class="font-bold text-lg leading-snug max-w-lg text-black bg-white border-2 border-black p-4 mt-6 hidden md:block shadow-[4px_4px_0_0_#000]">
        {siteData.about}
      </p>
    </div>

    <!-- Bottom text row -->
    <div class="flex flex-col xl:flex-row justify-between items-start xl:items-end gap-8 pt-6 mt-8">
      
      <!-- Role Scroller & Tagline -->
      <div class="flex-1 w-full xl:w-auto">
        <div class="overflow-hidden h-8 w-full max-w-sm text-sm font-bold uppercase tracking-wider text-black bg-white border-2 border-black px-3 flex items-center mb-4 shadow-[4px_4px_0_0_#000]">
          <div class="role-scroller w-full">
            {[...roles, roles[0]].map(role => (
              <div class="h-8 flex items-center text-safety-orange">▸ {role}</div>
            ))}
          </div>
        </div>
        
        <p class="text-xl lg:text-2xl font-black text-black h-8 flex items-center uppercase tracking-tight">
          <span id="typed-text"></span><span class="typing-cursor text-safety-orange bg-safety-orange inline-block w-4 h-6 ml-1"></span>
        </p>
      </div>

      <!-- CTA Button -->
      <a 
        href="#projects" 
        class="cursor-target border-2 border-black bg-safety-orange text-black px-8 py-4 font-bold uppercase text-sm tracking-wider hover:bg-black hover:text-white transition-colors duration-0 flex items-center gap-3 group shrink-0 shadow-[4px_4px_0_0_rgba(0,0,0,1)] hover:shadow-none hover:translate-x-1 hover:translate-y-1"
      >
        View Projects
        <i data-lucide="arrow-down-right" class="w-5 h-5 transition-transform duration-200"></i>
      </a>
    </div>
  </div>

  <!-- Right: Brutalist Photo Square -->
  <div class="lg:col-span-4 bg-concrete flex flex-col items-center justify-center p-6 lg:p-12 relative border-t-2 lg:border-t-0 lg:border-l-2 border-black">
    
    <!-- Top right decor in the right panel -->
    <div class="absolute top-6 right-6 flex gap-1">
      <div class="w-4 h-4 border-2 border-black bg-white"></div>
      <div class="w-4 h-4 border-2 border-black bg-safety-orange"></div>
      <div class="w-4 h-4 border-2 border-black bg-black"></div>
    </div>

    <div class="w-full max-w-[320px] aspect-square relative border-4 border-black bg-black shadow-[12px_12px_0_0_#ff4500] group overflow-hidden cursor-crosshair transition-transform duration-300 hover:-translate-y-1 hover:-translate-x-1 hover:shadow-[16px_16px_0_0_#ff4500]">
      
      <!-- DEFAULT STATE: Static ASCII / Tech Pattern -->
      <div class="absolute inset-0 bg-black flex flex-col items-center justify-center p-4 text-safety-orange font-mono text-[8.5px] leading-[8.5px] opacity-100 group-hover:opacity-0 transition-opacity duration-300 z-10" style="word-break: break-all;">
        <div class="opacity-40 select-none text-center">
          {staticAsciiRows.map(row => <div class="whitespace-nowrap">{row}</div>)}
        </div>
        
        <!-- Crosshair & Target Overlay -->
        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
          <div class="w-full h-px bg-safety-orange opacity-20"></div>
          <div class="h-full w-px bg-safety-orange opacity-20 absolute top-0 left-1/2"></div>
          <div class="w-24 h-24 border border-safety-orange rounded-full flex items-center justify-center">
            <div class="w-16 h-16 border border-safety-orange rounded-full border-dashed animate-[spin_10s_linear_infinite]"></div>
          </div>
          <div class="absolute bg-black px-2 py-1 border border-safety-orange font-tech text-[10px]">
            HOVER_TO_DECRYPT
          </div>
        </div>
      </div>

      <!-- HOVER STATE: Actual Photo with Brutalist Tweaks -->
      <div class="absolute inset-0 bg-black opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20">
        <img 
          src={photoUrl} 
          alt="Sai Srujan" 
          class="w-full h-full object-cover grayscale-[0.5] contrast-125 hover:grayscale-0 transition-all duration-500 mix-blend-luminosity hover:mix-blend-normal" 
        />
        
        <!-- Scanline Overlay -->
        <div class="absolute inset-0 pointer-events-none opacity-20" style="background-image: repeating-linear-gradient(transparent, transparent 2px, black 2px, black 4px);"></div>
        
        <!-- Corner Brackets -->
        <div class="absolute top-2 left-2 w-6 h-6 border-t-4 border-l-4 border-safety-orange"></div>
        <div class="absolute top-2 right-2 w-6 h-6 border-t-4 border-r-4 border-safety-orange"></div>
        <div class="absolute bottom-2 left-2 w-6 h-6 border-b-4 border-l-4 border-safety-orange"></div>
        <div class="absolute bottom-2 right-2 w-6 h-6 border-b-4 border-r-4 border-safety-orange"></div>

        <!-- Brutalist Badges -->
        <div class="absolute bottom-4 left-4 border-2 border-black bg-safety-orange text-black px-2 py-1 font-bold text-xs transform -rotate-3">
          VERIFIED ✓
        </div>
      </div>
    </div>
    
    <!-- Decor labels -->
    <div class="absolute bottom-6 right-6 font-tech text-[10px] uppercase text-black flex flex-col text-right select-none">
      <span class="font-bold border-b-2 border-black pb-1 mb-1">DATA_SOURCE: LOCAL</span>
      <span class="text-gray-500">IMG_SYS_ACTIVE</span>
    </div>
  </div>
</section>

<style is:global>
  /* role scroller */
  .role-scroller {
    animation: scroll-roles 12s cubic-bezier(0.1, 0, 0.1, 1) infinite;
  }
  
  @keyframes scroll-roles {
    0%, 15%   { transform: translateY(0); }
    20%, 35%  { transform: translateY(-2.0rem); } /* Adjusted based on h-8 (2rem) */
    40%, 55%  { transform: translateY(-4.0rem); }
    60%, 75%  { transform: translateY(-6.0rem); }
    80%, 95%  { transform: translateY(-8.0rem); }
    100%      { transform: translateY(-10.0rem); } 
  }

  /* typing cursor */
  .typing-cursor {
    animation: blink-cursor 0.8s step-end infinite;
  }

  @keyframes blink-cursor {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
</style>

<script is:inline>
  // ========================================
  // GRID OVERLAY (100 squares)
  // ========================================
  (function() {
    function initGridOverlay() {
      var gridContainer = document.getElementById('grid-overlay');
      if (!gridContainer) return;
      gridContainer.innerHTML = '';
      var totalSquares = 100;
      var fadedCount = 0;

      for (var i = 0; i < totalSquares; i++) {
        var square = document.createElement('div');
        square.className = 'grid-square';
        square.style.pointerEvents = 'auto';
        
        square.addEventListener('mouseover', function() {
          if (!this.classList.contains('fade-out')) {
            this.classList.add('fade-out');
            fadedCount++;
            if (fadedCount >= totalSquares) {
              gridContainer.remove();
            }
          }
        });

        square.addEventListener('touchstart', function() {
          if (!this.classList.contains('fade-out')) {
            this.classList.add('fade-out');
            fadedCount++;
            if (fadedCount >= totalSquares) {
              gridContainer.remove();
            }
          }
        }, { passive: true });

        gridContainer.appendChild(square);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initGridOverlay);
    } else {
      initGridOverlay();
    }
  })();

  // ========================================
  // TYPING EFFECT
  // ========================================
  (function() {
    var tagline = 'Building Digital Infrastructure.';
    var typedEl = document.getElementById('typed-text');
    var charIndex = 0;

    function typeChar() {
      if (!typedEl) return;
      if (charIndex < tagline.length) {
        typedEl.textContent += tagline[charIndex];
        charIndex++;
        setTimeout(typeChar, 40 + Math.random() * 40);
      }
    }

    // Start typing after ~2s to allow preloader to clear
    setTimeout(typeChar, 2000);
  })();
</script>
